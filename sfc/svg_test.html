<!DOCTYPE html><style>body {height: 100%;} .MapSVG{border: 2px solid black;}.MapSVG:has(>#MapSVG_states_trivial_2_obj_3:hover) ~ .MapSVG>#MapSVG_states_trivial_2_obj_3{fill: green;}</style>
<svg class="MapSVG" id="MapSVG_states_trivial_2" style="position: absolute;left: 0px;top: 0px" width="800" height="800" viewBox="-66.29819209148752 -66.29816782497659 66.29817702396417 66.2982012904751">
<g id="map_group">
<defs>
<g id="MapSVG_states_trivial_2_0">
<path id="path1" fill-rule="evenodd" d="M 0.7148791970042475 0.5087879462585227 L -5.508822478048822 1.6496907699753203 L -11.732845026006261 2.790039784915979 L -18.89011312043338 0.920948080590679 L -26.047412161489827 -0.9491987603178442 L -31.442634244196377 -0.06977687566132663 L -36.83845550669478 0.809323008684932 L -42.2349482459891 1.6881395800451326 L -47.63218480281487 2.566711522360671 L -55.6225633115747 0.06890983832044688 L -63.61390102521326 -2.431028720252794 L -64.95670258290404 -8.144249104782707 L -66.29819209148752 -13.858136195754103 L -61.10145603023493 -18.3157431655904 L -55.90610682980285 -22.77280008343996 L -53.09671136235269 -28.06387484448656 L -50.287675470068564 -33.35479148519882 L -54.42730462404143 -38.13898190393702 L -58.56538026244707 -42.925287994504124 L -55.96341763918648 -47.386244406332665 L -53.362007504223236 -51.84729251557333 L -44.44854748604738 -52.4520998065499 L -35.537310818847544 -53.06004368571478 L -28.394615013107938 -48.79335861741104 L -21.249912937840914 -44.530052699589135 L -27.058160617895616 -38.722467599913784 L -20.219333886215306 -37.05612774619188 L -13.380162645095142 -35.39169288833355 L -6.125130867935019 -37.67234066840617 L -4.155510661892557 -42.44592603284797 L -2.186554475920249 -47.22010093383661 L 4.236090029511512 -46.389991250771665 L 3.200907744437002 -40.2663343618747 L 2.1652060030290876 -34.14349127962214 L 3.202301201508562 -27.087640587349288 L 3.8249197831715067 -21.069933969500052 L 4.447669730351689 -15.052604809083398 L 1.3370498484916107 -7.3754374986662725 L 0.7148791970042475 0.5087879462585227 Z"/>
<circle class="MapSVG_states_trivial_2_district_circle" id="MapSVG_states_trivial_2_circle_0" district_id="0" r="5" cx="-28.605671517171626" cy="-24.75744142387729" fill="red" />
</g>
<mask id="MapSVG_states_trivial_2_inner_0"><rect x="-1000" y="-1000" width="2000" height="2000" fill="black"/><use href = "#MapSVG_states_trivial_2_0" fill="white"/> </mask>
<g id="MapSVG_states_trivial_2_1">
<path id="path1" fill-rule="evenodd" d="M 0.7148791970042475 0.5087879462585227 L 1.3370498484916107 -7.3754374986662725 L 4.447669730351689 -15.052604809083398 L 3.8249197831715067 -21.069933969500052 L 3.202301201508562 -27.087640587349288 L 2.1652060030290876 -34.14349127962214 L 3.200907744437002 -40.2663343618747 L 4.236090029511512 -46.389991250771665 L 5.894236553515202 -43.48413271283289 L 9.417475097184235 -41.616963968422475 L 8.171043941570874 -51.165876554433545 L 13.143991843535465 -48.676692125333254 L 17.28439880970104 -53.03943837652254 L 23.910168853609534 -55.952542969081364 L 33.6456586284204 -56.172627930975914 L 41.522374094609916 -53.900766453839175 L 48.788327845201344 -47.47511894313051 L 52.32546746025384 -41.04285793921369 L 49.22720454970666 -33.97604787055499 L 46.12649233249948 -26.911480386521717 L 51.21323117540366 -24.011736440296634 L 56.301247410487576 -21.112066390340207 L 59.1099569565469 -16.44363470647335 L 61.91889219277917 -11.774799571897976 L 56.520857961580546 -12.390712357657103 L 51.12378504124861 -13.007089560332403 L 45.41907446655788 -10.924921929084542 L 39.71449200440405 -8.8440196900976 L 45.320803135153824 -4.904761720391194 L 50.928295814332216 -0.9651255209101228 L 55.07759846300223 -3.668052955667849 L 62.55184380972517 -3.67595742547823 L 66.29817702396417 4.420266878571322 L 57.786128815913685 7.334773776176882 L 53.21874641938073 8.168451413434873 L 47.92456172022518 7.860280475342008 L 42.63108586495906 7.551845980944311 L 33.70497674622821 4.235435895201013 L 24.471454624077605 6.106803758492514 L 15.238480416911969 7.976642958634457 L 7.769153754965971 8.185173512165619 L 0.29999919252078433 6.525687506896788 L 0.7148791970042475 0.5087879462585227 Z"/>
<circle class="MapSVG_states_trivial_2_district_circle" id="MapSVG_states_trivial_2_circle_1" district_id="1" r="5" cx="32.240162218070395" cy="-19.15488546446512" fill="red" />
</g>
<mask id="MapSVG_states_trivial_2_inner_1"><rect x="-1000" y="-1000" width="2000" height="2000" fill="black"/><use href = "#MapSVG_states_trivial_2_1" fill="white"/> </mask>
<g id="MapSVG_states_trivial_2_2">
<path id="path1" fill-rule="evenodd" d="M 0.7148791970042475 0.5087879462585227 L 0.29999919252078433 6.525687506896788 L 0.46260046209923866 12.017743908529896 L 0.6252128878252088 17.509981698058766 L 2.7335300423069597 26.294500950816367 L 1.1523212849958566 35.255780271368984 L -2.8885132953745285 43.16396596461142 L -6.7532219592607055 51.60103144951758 L -13.779768833817675 56.17266139647442 L -14.834864367743815 49.31659272729818 L -23.619664134078793 49.318027853486235 L -32.23010618657567 47.561891580507904 L -41.0171080936789 47.740185900232696 L -47.52208027850781 42.6425168031403 L -51.6540524837909 39.12637614490448 L -55.78624484149642 35.60978536615849 L -60.35823921414305 31.740881819838307 L -62.995868857592704 28.22317401034901 L -59.82970193672162 24.178868812872487 L -60.88088537385492 14.331085815076683 L -63.69212882655305 10.63657196331485 L -63.686650604566644 3.778430831018153 L -65.79267360693547 -0.2682840086217757 L -63.61390102521326 -2.431028720252794 L -55.6225633115747 0.06890983832044688 L -47.63218480281487 2.566711522360671 L -42.2349482459891 1.6881395800451326 L -36.83845550669478 0.809323008684932 L -31.442634244196377 -0.06977687566132663 L -26.047412161489827 -0.9491987603178442 L -18.89011312043338 0.920948080590679 L -11.732845026006261 2.790039784915979 L -5.508822478048822 1.6496907699753203 L 0.7148791970042475 0.5087879462585227 Z"/>
<circle class="MapSVG_states_trivial_2_district_circle" id="MapSVG_states_trivial_2_circle_2" district_id="2" r="5" cx="-29.793816652991758" cy="22.85246598222761" fill="red" />
</g>
<mask id="MapSVG_states_trivial_2_inner_2"><rect x="-1000" y="-1000" width="2000" height="2000" fill="black"/><use href = "#MapSVG_states_trivial_2_2" fill="white"/> </mask>
<g id="MapSVG_states_trivial_2_3">
<path id="path1" fill-rule="evenodd" d="M 0.29999919252078433 6.525687506896788 L 7.769153754965971 8.185173512165619 L 15.238480416911969 7.976642958634457 L 24.471454624077605 6.106803758492514 L 33.70497674622821 4.235435895201013 L 42.63108586495906 7.551845980944311 L 47.92456172022518 7.860280475342008 L 53.21874641938073 8.168451413434873 L 57.786128815913685 7.334773776176882 L 57.98061760769102 12.61465462389955 L 58.05619819280004 18.01079593537397 L 52.80721462034313 21.22107014648871 L 44.71544521847816 25.378673472987906 L 46.028214743325336 33.544408878337364 L 50.04180842983078 41.995832648391264 L 45.57750583614387 44.62989685808038 L 41.11364351670016 47.263702805106426 L 34.52842795801902 51.140960806541756 L 27.94418112540405 55.01812974940504 L 22.678431435058833 54.650671577122665 L 17.412951442833698 54.283570332668155 L 10.39258483323623 53.989777169955254 L 3.3724292436253425 53.69654161096199 L -0.4301384130530698 51.06218193393329 L -6.7532219592607055 51.60103144951758 L -2.8885132953745285 43.16396596461142 L 1.1523212849958566 35.255780271368984 L 2.7335300423069597 26.294500950816367 L 0.6252128878252088 17.509981698058766 L 0.46260046209923866 12.017743908529896 L 0.29999919252078433 6.525687506896788 Z"/>
<circle class="MapSVG_states_trivial_2_district_circle" id="MapSVG_states_trivial_2_circle_3" district_id="3" r="5" cx="25.0914402665015" cy="28.546772320787845" fill="red" />
</g>
<mask id="MapSVG_states_trivial_2_inner_3"><rect x="-1000" y="-1000" width="2000" height="2000" fill="black"/><use href = "#MapSVG_states_trivial_2_3" fill="white"/> </mask>
                <marker 
                  id='arrowhead_black' 
                  orient="auto" 
                  markerWidth='5' 
                  markerHeight='4' 
                  refX='3' 
                  refY='2'
                >
                  <path d='M0,0 V4 L4,2 Z' fill="black" />
                </marker>
            
                <marker 
                  id='arrowhead_white' 
                  orient="auto" 
                  markerWidth='5' 
                  markerHeight='4' 
                  refX='3' 
                  refY='2'
                >
                  <path d='M0,0 V4 L4,2 Z' fill="white" />
                </marker>
            
                <marker 
                  id='arrowhead_blue' 
                  orient="auto" 
                  markerWidth='5' 
                  markerHeight='4' 
                  refX='3' 
                  refY='2'
                >
                  <path d='M0,0 V4 L4,2 Z' fill="blue" />
                </marker>
            
                <marker 
                  id='arrowhead_red' 
                  orient="auto" 
                  markerWidth='5' 
                  markerHeight='4' 
                  refX='3' 
                  refY='2'
                >
                  <path d='M0,0 V4 L4,2 Z' fill="red" />
                </marker>
            </defs>
<use id="MapSVG_states_trivial_2_obj_0" href="#MapSVG_states_trivial_2_0" stroke-width="0.1" stroke="red" fill="none" mask="url(#MapSVG_states_trivial_2_inner_0)" stroke-linejoin="round"/>
<use id="MapSVG_states_trivial_2_obj_1" href="#MapSVG_states_trivial_2_1" stroke-width="0.1" stroke="red" fill="none" mask="url(#MapSVG_states_trivial_2_inner_1)" stroke-linejoin="round"/>
<use id="MapSVG_states_trivial_2_obj_2" href="#MapSVG_states_trivial_2_2" stroke-width="0.1" stroke="red" fill="none" mask="url(#MapSVG_states_trivial_2_inner_2)" stroke-linejoin="round"/>
<use id="MapSVG_states_trivial_2_obj_3" href="#MapSVG_states_trivial_2_3" stroke-width="0.1" stroke="red" fill="none" mask="url(#MapSVG_states_trivial_2_inner_3)" stroke-linejoin="round"/>
<use id="MapSVG_states_trivial_2_g_0" href = "#MapSVG_states_trivial_2_0" fill="white" fill-opacity="0.0" stroke="none"/>
<use id="MapSVG_states_trivial_2_g_1" href = "#MapSVG_states_trivial_2_1" fill="white" fill-opacity="0.0" stroke="none"/>
<use id="MapSVG_states_trivial_2_g_2" href = "#MapSVG_states_trivial_2_2" fill="white" fill-opacity="0.0" stroke="none"/>
<use id="MapSVG_states_trivial_2_g_3" href = "#MapSVG_states_trivial_2_3" fill="white" fill-opacity="0.0" stroke="none"/>
<line id="MapSVG_states_trivial_2_0_north_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:black;stroke-width:2" marker-end="url(#arrowhead_black)" />
<line id="MapSVG_states_trivial_2_0_east_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:blue;stroke-width:2" marker-end="url(#arrowhead_blue)" />
<line id="MapSVG_states_trivial_2_0_south_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:red;stroke-width:2" marker-end="url(#arrowhead_red)" />
<line id="MapSVG_states_trivial_2_0_west_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:white;stroke-width:2" marker-end="url(#arrowhead_white)" />
<line id="MapSVG_states_trivial_2_1_north_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:black;stroke-width:2" marker-end="url(#arrowhead_black)" />
<line id="MapSVG_states_trivial_2_1_east_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:blue;stroke-width:2" marker-end="url(#arrowhead_blue)" />
<line id="MapSVG_states_trivial_2_1_south_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:red;stroke-width:2" marker-end="url(#arrowhead_red)" />
<line id="MapSVG_states_trivial_2_1_west_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:white;stroke-width:2" marker-end="url(#arrowhead_white)" />
<line id="MapSVG_states_trivial_2_2_north_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:black;stroke-width:2" marker-end="url(#arrowhead_black)" />
<line id="MapSVG_states_trivial_2_2_east_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:blue;stroke-width:2" marker-end="url(#arrowhead_blue)" />
<line id="MapSVG_states_trivial_2_2_south_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:red;stroke-width:2" marker-end="url(#arrowhead_red)" />
<line id="MapSVG_states_trivial_2_2_west_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:white;stroke-width:2" marker-end="url(#arrowhead_white)" />
<line id="MapSVG_states_trivial_2_3_north_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:black;stroke-width:2" marker-end="url(#arrowhead_black)" />
<line id="MapSVG_states_trivial_2_3_east_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:blue;stroke-width:2" marker-end="url(#arrowhead_blue)" />
<line id="MapSVG_states_trivial_2_3_south_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:red;stroke-width:2" marker-end="url(#arrowhead_red)" />
<line id="MapSVG_states_trivial_2_3_west_miniarrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:white;stroke-width:2" marker-end="url(#arrowhead_white)" />
<line id="MapSVG_states_trivial_2_north_arrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:black;stroke-width:2" marker-end="url(#arrowhead_black)" />
<line id="MapSVG_states_trivial_2_east_arrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:blue;stroke-width:2" marker-end="url(#arrowhead_blue)" />
<line id="MapSVG_states_trivial_2_south_arrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:red;stroke-width:2" marker-end="url(#arrowhead_red)" />
<line id="MapSVG_states_trivial_2_west_arrowline" x1="0" y1="0" x2="0" y2="0" style="pointer-events: none;stroke:white;stroke-width:2" marker-end="url(#arrowhead_white)" /></svg>
<svg class="MapSVG_mouseover" id="MapSVG_states_trivial_2_mouseover_area" style="position: absolute;left: 0px;top: 0px;z-index:2;pointer-events: none;user-select: none;-webkit-user-drag: none;" width="800" height="800" viewBox="0 0 800 800">
<text id="MapSVG_states_trivial_2_label_text" x="50" y="50" fill="black" fill-opacity="1.0" stroke="black">None</text>
<rect id="MapSVG_states_trivial_2_mouseover_rect" x="0" y="0" width="10" height="10" rx="10" ry="10" fill="black" fill-opacity="0.0" stroke="none" style="z-index:2;"/>
<text id="MapSVG_states_trivial_2_mouseover_text" x="0" y="0" fill="white" fill-opacity="0.0" stroke="none" style="z-index:3;" dominant-baseline="hanging">None</text>
</svg><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script>
    var hovered_district = {};
    var clicked_district = {};
    var nav_arr_dict = {};
    var map_svg_list = document.getElementsByClassName("MapSVG");
    for(var map_i=0;map_i<map_svg_list.length;map_i++){
        let map_id = map_svg_list[map_i].id;
        hovered_district[map_id] = "";
        clicked_district[map_id] = "";
        nav_arr_dict[map_id] = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    }
    var in_direction_dict = {};
    var all_in_direction_dict = {};
    var connection_grid_dict = {};
    var centroid_arr_dict = {};
    var all_data_string_dict = {};
    var mouseoverable_list = [];
    var mouseoverable_dict = [];

    
            in_direction_dict["MapSVG_states_trivial_2"] = [[2,-1,-1,2],[3,-1,0,3],[3,0,0,-1],[-1,1,1,-1]];;
        all_in_direction_dict["MapSVG_states_trivial_2"] = [[[2],[-1],[-1],[2]],
                                                            [[3],[-1],[0],[3]],
                                                            [[3],[0],[0],[-1]],
                                                            [[-1],[1],[1],[-1]]];;
        connection_grid_dict["MapSVG_states_trivial_2"] = [[[0,0,0,0],[321,0,0,0],[421,0,0,530],[0,0,0,0]],[[0,0,377,0],[0,0,0,0],[0,0,0,73],[414,0,0,388]],[[0,529,470,0],[0,72,0,0],[0,0,0,0],[542,0,0,0]],[[0,0,0,0],[0,603,396,0],[0,0,357,0],[0,0,0,0]]];;
        all_data_string_dict["MapSVG_states_trivial_2"] = {};;
        centroid_arr_dict["MapSVG_states_trivial_2"] = [[-0.017549828907248752,0.06932687588740948],[-0.015958428819745848,0.07087030495175466],[-0.01635335452353126,0.06807060553162543],[-0.014657253759393878,0.0693457828208823]];;
            mouseoverable_list.push({id:"0", attributes:{NAME:"District A"}});
mouseoverable_dict["0"] = {id:"0", attributes:{NAME:"District A"}}
mouseoverable_list.push({id:"1", attributes:{NAME:"District B"}});
mouseoverable_dict["1"] = {id:"1", attributes:{NAME:"District B"}}
mouseoverable_list.push({id:"2", attributes:{NAME:"District C"}});
mouseoverable_dict["2"] = {id:"2", attributes:{NAME:"District C"}}
mouseoverable_list.push({id:"3", attributes:{NAME:"District D"}});
mouseoverable_dict["3"] = {id:"3", attributes:{NAME:"District D"}}

    const mouseover_buffer = 12;
    const ARROWHEAD_PIXEL_GAP = 10;
    const STANDARD_FILL = false;
    function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
    }
    function reset_hovered(hovered_district_id,map_id){
        let district_name = "";
        if(hovered_district_id in mouseoverable_dict){
            district_name = mouseoverable_dict[hovered_district_id].attributes.NAME;
        }
        document.getElementById(map_id+'_label_text').innerHTML=''+district_name;
        document.getElementById(map_id+"_mouseover_text").innerHTML = ''+district_name;
        if(hovered_district_id==''){
            document.getElementById(map_id+"_mouseover_rect").setAttribute('fill-opacity', "0.0");
            document.getElementById(map_id+"_mouseover_text").setAttribute('fill-opacity', "0.0");
        }else{
            document.getElementById(map_id+"_mouseover_rect").setAttribute('fill-opacity', "0.1");
            //document.getElementById(map_id+"_mouseover_rect").setAttribute('width', "100");
            //document.getElementById(map_id+"_mouseover_rect").setAttribute('height', "40");
            document.getElementById(map_id+"_mouseover_rect").setAttribute('width', ""+(mouseover_buffer*2+document.getElementById(map_id+"_mouseover_text").getBBox().width));
            document.getElementById(map_id+"_mouseover_rect").setAttribute('height', ""+(mouseover_buffer*2-5+document.getElementById(map_id+"_mouseover_text").getBBox().height));
            document.getElementById(map_id+"_mouseover_text").setAttribute('fill-opacity', "1.0");
        }
    }
    for(var map_i=0;map_i<map_svg_list.length;map_i++){
        let map_id = map_svg_list[map_i].id;
        for(var i=0;i<mouseoverable_list.length;i+=1){
            var current_member_code = mouseoverable_list[i].id;
            var fill_color = "grey";
            if(current_member_code!=''){
                fill_color = "grey";
            }
            if(STANDARD_FILL){
                document.getElementById(map_id+'_obj_'+mouseoverable_list[i].id).style.fill = fill_color;
            }
            document.getElementById(map_id+'_g_'+mouseoverable_list[i].id).addEventListener('mouseenter', function(e) {
                var current_member_code = e.target.id.substring(3+map_id.length);
                var hovered_district_was = ''+hovered_district[map_id];
                hovered_district[map_id] = current_member_code;
    
                var fill_color = "orange";
                if(STANDARD_FILL){
                    if(hovered_district_was!=''){
                        if(hovered_district_was==clicked_district[map_id]){
                            document.getElementById(map_id+'_obj_'+hovered_district_was).style.fill = "green";
                        }else{
                            document.getElementById(map_id+'_obj_'+hovered_district_was).style.fill = "grey";
                        }
                    }
                    document.getElementById(map_id+'_obj_'+current_member_code).style.fill = fill_color;
                }
                reset_hovered(hovered_district[map_id],map_id);
            });
            document.getElementById(map_id+'_g_'+mouseoverable_list[i].id).addEventListener('mouseleave', function(e) {
                var current_member_code = e.target.id.substring(3+map_id.length);
                if(STANDARD_FILL){
                    if(current_member_code==clicked_district[map_id]){
                        document.getElementById(map_id+'_obj_'+current_member_code).style.fill = "green";
                    }else{
                        document.getElementById(map_id+'_obj_'+current_member_code).style.fill = "grey";
                    }
                }
                if(current_member_code==hovered_district[map_id]){
                    hovered_district[map_id] = '';
                }
                reset_hovered(hovered_district[map_id],map_id);
            });
        }
    }
    let view_box_bounds_by_id = {};
    let ultimate_bounds_by_id = {};
    
    var zooms_initialized = false;
    
    function initialize_view_box_dicts(){
        var map_svg_list = document.getElementsByClassName("MapSVG");
        for(var map_i=0;map_i<map_svg_list.length;map_i++){
            let map_id = map_svg_list[map_i].id;
            if (!(map_id in view_box_bounds_by_id)) {
                var rect = document.getElementById(map_id).getBoundingClientRect();
                let box_width = 132.5963691154517;
            let box_height = box_width*(rect.bottom-rect.top)/(rect.right-rect.left)
            let center_pos = [-7.533761674949346e-06,1.6732749259062984e-05];
            view_box_bounds_by_id[map_id] = [center_pos[0]-box_width/2,center_pos[1]-box_height/2,box_width,box_height];
            ultimate_bounds_by_id[map_id] = [center_pos[0]-box_width/2,center_pos[1]-box_height/2,box_width,box_height];
        }
    }
}

function initialize_zooms(){
    var map_svg_list = document.getElementsByClassName("MapSVG");
    initialize_view_box_dicts();
    select_district();
    for(var map_i=0;map_i<map_svg_list.length;map_i++){
        let map_id = map_svg_list[map_i].id;
        // REDRAW ARROWS
        var cardinal_directions = ["east","north","west","south"];
        var district_circles = document.getElementsByClassName(map_id+"_district_circle");
        for(var theta_i=0;theta_i<cardinal_directions.length;theta_i++){
            document.getElementById(map_id+"_"+cardinal_directions[theta_i]+"_arrowline").style["stroke-width"] = 12*view_box_bounds_by_id[map_id][2]/1200+"px";
            if(document.getElementById(map_id+"_"+cardinal_directions[theta_i]+"_arrowline").getAttribute('stroke-dasharray') !== null){
                var dasharray_list = document.getElementById(map_id+"_"+cardinal_directions[theta_i]+"_arrowline").getAttribute('stroke-dasharray').split(" ");
                var dasharray_max = parseFloat(document.getElementById(map_id+"_"+cardinal_directions[theta_i]+"_arrowline").getAttribute('stroke-dasharray-max'));
                for(var dash_i=0;dash_i<dasharray_list.length;dash_i++){
                    dasharray_list[dash_i] = parseFloat(dasharray_list[dash_i]);
                }
                var max_in_list = Math.max(...dasharray_list);
                for(var dash_i=0;dash_i<dasharray_list.length;dash_i++){
                    dasharray_list[dash_i] = dasharray_list[dash_i]/max_in_list*dasharray_max*6*view_box_bounds_by_id[map_id][2]/1200;
                }
                if(dasharray_list.join(" ")!="NaN"){
                    document.getElementById(map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute("stroke-dasharray",dasharray_list.join(" "));
                }
            }





            for(var district_i=0;district_i<district_circles.length;district_i++){
                var district_id = district_circles[district_i].getAttribute("district_id");
                document.getElementById(map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").style["stroke-width"] = 4*view_box_bounds_by_id[map_id][2]/1200+"px";
                if(document.getElementById(map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").getAttribute('stroke-dasharray') !== null){
                    var dasharray_list = document.getElementById(map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").getAttribute('stroke-dasharray').split(" ");
                    var dasharray_max = parseFloat(document.getElementById(map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").getAttribute('stroke-dasharray-max'));
                    for(var dash_i=0;dash_i<dasharray_list.length;dash_i++){
                        dasharray_list[dash_i] = parseFloat(dasharray_list[dash_i]);
                    }
                    var max_in_list = Math.max(...dasharray_list);
                    for(var dash_i=0;dash_i<dasharray_list.length;dash_i++){
                        dasharray_list[dash_i] = dasharray_list[dash_i]/max_in_list*dasharray_max*6*view_box_bounds_by_id[map_id][2]/1200;
                    }
                    if(dasharray_list.join(" ")!="NaN"){
                        document.getElementById(map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute("stroke-dasharray",dasharray_list.join(" "));
                    }
                }
            }
        }

        var district_circles = document.getElementsByClassName(map_id+"_district_circle");
        for(var i=0;i<district_circles.length;i++){
            district_circles[i].setAttribute("r",20*view_box_bounds_by_id[map_id][2]/1200);
        }
    }
    //arrow endpoint should be slightly before target end, by a few pixels
    zooms_initialized = true;
}

var map_svg_list = document.getElementsByClassName("MapSVG");
for(var i=0;i<map_svg_list.length;i++){
    map_svg_list[i].addEventListener('wheel', preventScroll, {passive: false});
}
window.addEventListener("keydown", function(e) {
    // space and arrow keys
    if([37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
    }
}, false);
function preventScroll(e){
    e.preventDefault();

    return false;
}

var current_map_id = "MapSVG_states_trivial_2";
window.addEventListener("wheel", event => {
    var map_svg_list = document.getElementsByClassName("MapSVG");
    initialize_view_box_dicts();
    for(var i=0;i<map_svg_list.length;i++){
        let map_id = map_svg_list[i].id;
        let view_box_bounds = view_box_bounds_by_id[map_id];
        let ultimate_bounds = ultimate_bounds_by_id[map_id];
        var rect = document.getElementById(map_id).getBoundingClientRect();
        if(event.clientX>rect.left&&event.clientX<rect.right&&event.clientY>rect.top&&event.clientY<rect.bottom){
            event.preventDefault();
            event.stopPropagation();
            current_map_id = map_id;
            var mouse_x = (event.clientX - rect.left)/(rect.right-rect.left);
            var mouse_y = (event.clientY - rect.top)/(rect.bottom-rect.top);
            var mouse_x_in_svg = view_box_bounds[0]+(view_box_bounds[2])*mouse_x;
            var mouse_y_in_svg = view_box_bounds[1]+(view_box_bounds[3])*mouse_y;
            var product = 1.002**event.deltaY;
            view_box_bounds = [mouse_x_in_svg+(view_box_bounds[0]-mouse_x_in_svg)*product,mouse_y_in_svg+(view_box_bounds[1]-mouse_y_in_svg)*product,view_box_bounds[2]*product,view_box_bounds[3]*product]
            view_box_bounds[0] = Math.max(ultimate_bounds[0],view_box_bounds[0]);
            view_box_bounds[1] = Math.max(ultimate_bounds[1],view_box_bounds[1]);
            view_box_bounds[2] = Math.min(view_box_bounds[2],ultimate_bounds[2]);
            view_box_bounds[3] = Math.min(view_box_bounds[3],ultimate_bounds[3]);
            if(view_box_bounds[2]+view_box_bounds[0]>ultimate_bounds[2]+ultimate_bounds[0]){
                view_box_bounds[0] = Math.min(ultimate_bounds[2]+ultimate_bounds[0],view_box_bounds[2]+view_box_bounds[0])-view_box_bounds[2];
            }
            if(view_box_bounds[3]+view_box_bounds[1]>ultimate_bounds[3]+ultimate_bounds[1]){
                view_box_bounds[1] = Math.min(ultimate_bounds[3]+ultimate_bounds[1],view_box_bounds[3]+view_box_bounds[1])-view_box_bounds[3];
            }
            //view_box_bounds[3] = Math.min(ultimate_bounds[3],view_box_bounds[3]);
            document.getElementById(map_id).setAttribute("viewBox",""+view_box_bounds[0]+" "+view_box_bounds[1]+" "+view_box_bounds[2]+" "+view_box_bounds[3]);

            view_box_bounds_by_id[map_id] = view_box_bounds;
        }
    }
    initialize_zooms();

});

addEventListener("mousemove", (event) => {
    for(var i=0;i<map_svg_list.length;i++){
        let map_id = map_svg_list[i].id;
        var rect = document.getElementById(map_id).getBoundingClientRect();
        if(event.clientX>rect.left&&event.clientX<rect.right&&event.clientY>rect.top&&event.clientY<rect.bottom){
            current_map_id = map_id;
        }


        var rect = document.getElementById(map_id).getBoundingClientRect();
        var mouse_x = event.clientX - rect.left;
        var mouse_y = event.clientY - rect.top;
        document.getElementById(map_id+"_mouseover_rect").setAttribute('x', ""+mouse_x);
        document.getElementById(map_id+"_mouseover_rect").setAttribute('y', ""+mouse_y);
        document.getElementById(map_id+"_mouseover_text").setAttribute('x', ""+(mouseover_buffer+mouse_x));
        document.getElementById(map_id+"_mouseover_text").setAttribute('y', ""+(mouseover_buffer+mouse_y));
    }
});

function color_map(map_id,new_position){

    var district_circles = document.getElementsByClassName(map_id+"_district_circle");
    for(var district_i=0;district_i<district_circles.length;district_i++){
        var district_id = district_circles[district_i].getAttribute("district_id").toString();
        var district_obj = document.getElementById(map_id+'_obj_'+district_id);
        var district_circle = district_circles[district_i];
        if(district_id==new_position.toString()){
            district_obj.style.fill = "#aa0000";
        }else{
            district_obj.style.fill = "#3333ff";
        }
        district_circle.style.fill = district_obj.style.fill;
    }
}

var already_passed = [];
var scores_storage = [];
var score_stacking = 1;
var prev = [];
function get_in_direction(map_id,state_i,theta_i,simple=true,simulate=false) {
    var in_both = [];
    var new_position = -1;

    var cx = parseFloat(document.getElementById(map_id+"_circle_"+state_i).getAttribute("cx"));
    var cy = parseFloat(document.getElementById(map_id+"_circle_"+state_i).getAttribute("cy"));

    centroid_arr_dict[map_id];
    connection_grid_dict[map_id];
    var district_circles = document.getElementsByClassName(map_id+"_district_circle");
    var cleaned_scores = [];
    var score_storage_was = scores_storage.slice();
    var score_stacking_was = score_stacking+0;
    if(!simple){
        var scores = [];
        var best_score = 45;
        var best_score_i = state_i;
        for(var district_i=0;district_i<district_circles.length;district_i++){
            var district_id = parseInt(district_circles[district_i].getAttribute("district_id"));
            var diff_x = centroid_arr_dict[map_id][district_id][0]-centroid_arr_dict[map_id][state_i][0];
            var diff_y = centroid_arr_dict[map_id][district_id][1]-centroid_arr_dict[map_id][state_i][1];
            var angle = 180/Math.PI*((Math.atan2(diff_y,diff_x)+Math.PI*4+Math.PI/4+Math.PI/2*(2-theta_i))%(Math.PI*2));
            angle = Math.max(0,90-Math.abs(angle-180));
            var score = connection_grid_dict[map_id][state_i][district_id][theta_i]+connection_grid_dict[map_id][district_id][state_i][(theta_i+2)%4]/2;
            cleaned_scores.push(score+0);
            if(scores_storage.length<=district_id){
                scores_storage.push(score);
            }else{
                score += scores_storage[district_id]*2/3;
                scores_storage[district_id] = score;
            }
            var multiplier = 1;
            if(prev[0]==district_id&&(prev[1]+theta_i)%2==1){
                multiplier /= 5;
            }
            if(state_i==district_id){
                multiplier = 0;
            }
            multiplier /= score_stacking;
            if(connection_grid_dict[map_id][state_i][district_id][theta_i]+connection_grid_dict[map_id][district_id][state_i][(theta_i+2)%4]/2==0){
                multiplier = 0;
            }
            var district_obj = document.getElementById(map_id+'_obj_'+district_id);
            var district_circle = district_circles[district_i];
            //district_obj.style.fill = rgbToHex(Math.floor((multiplier*(angle+6*score))/2/360*255),Math.floor(angle*255/360),255-Math.floor((multiplier*(angle+6*score))/2/360*255));
            scores.push(multiplier*(angle+8*score));
            if(multiplier*(angle+8*score)>best_score){
                best_score = multiplier*(angle+8*score);
                best_score_i = district_id;
            }
        }
        score_stacking = score_stacking*2/3+1;
        new_position = best_score_i;
        if(new_position!=state_i){
            for(var district_i=0;district_i<district_circles.length;district_i++){
                var district_id = parseInt(district_circles[district_i].getAttribute("district_id"));
                var district_obj = document.getElementById(map_id+'_obj_'+district_id);
                district_obj.style.fill = rgbToHex(Math.floor(scores[district_i]/best_score*255*12/15+255*3/15),Math.floor(scores[district_i]/best_score*255*12/15+255*3/15),255-Math.floor(scores[district_i]/best_score*255));
                if(district_id==new_position.toString()){
                    district_obj.style.fill = "#aa0000";
                }
                district_circles[district_i].style.fill = district_obj.style.fill;
            }
        }
    }else if(simulate){
        var scores = [];
        var best_score = 45;
        var best_score_i = state_i;
        var sim_score_stacking = score_stacking+0;
        for(var district_i=0;district_i<district_circles.length;district_i++){
            var district_id = parseInt(district_circles[district_i].getAttribute("district_id"));
            var diff_x = centroid_arr_dict[map_id][district_id][0]-centroid_arr_dict[map_id][state_i][0];
            var diff_y = centroid_arr_dict[map_id][district_id][1]-centroid_arr_dict[map_id][state_i][1];
            var angle = 180/Math.PI*((Math.atan2(diff_y,diff_x)+Math.PI*4+Math.PI/4+Math.PI/2*(2-theta_i))%(Math.PI*2));
            angle = Math.max(0,90-Math.abs(angle-180));
            var score = connection_grid_dict[map_id][state_i][district_id][theta_i]+connection_grid_dict[map_id][district_id][state_i][(theta_i+2)%4]/2;

            if(scores_storage.length<=district_id){
            }else{
                score += scores_storage[district_id]*2/3;
            }
            var multiplier = 1;
            if(prev[0]==district_id&&(prev[1]+theta_i)%2==1){
                multiplier /= 5;
            }
            if(state_i==district_id){
                multiplier = 0;
            }
            multiplier /= sim_score_stacking;
            if(connection_grid_dict[map_id][state_i][district_id][theta_i]+connection_grid_dict[map_id][district_id][state_i][(theta_i+2)%4]/2==0){
                multiplier = 0;
            }
            var district_obj = document.getElementById(map_id+'_obj_'+district_id);
            var district_circle = district_circles[district_i];
            scores.push(multiplier*(angle+8*score));
            if(multiplier*(angle+8*score)>best_score){
                best_score = multiplier*(angle+8*score);
                best_score_i = district_id;
            }
        }
        sim_score_stacking = sim_score_stacking*2/3+1;
        new_position = best_score_i;

    }

    if(!simple){
    }else if(!simulate){
        if(state_i==clicked_district[map_id]){
        }else{
        }
    }
    if(!simple){
        //color_map(map_id,new_position);
        if((prev[1]+theta_i)%2==1){
            score_stacking = 1;
            scores_storage = cleaned_scores;
        }
        scores_storage[state_i] = 0;
        if(new_position==state_i){
            scores_storage = score_storage_was.slice();
            score_stacking = score_stacking_was+0;
        }else{
            prev = [state_i,theta_i+0];
        }
    }


    return new_position;
}


document.onkeydown = function(e) {
    var theta_i = 0;
    switch (e.keyCode) {
        case 37:
            theta_i = 2;
            break;
        case 38:
            theta_i = 1;
            break;
        case 39:
            theta_i = 0;
            break;
        case 40:
            theta_i = 3;
            break;
    }
    var new_position = get_in_direction(current_map_id,clicked_district[current_map_id],theta_i,false);

    if(new_position!=-1){
        if(STANDARD_FILL){
            document.getElementById(current_map_id+'_obj_'+clicked_district[current_map_id]).style.fill = "grey";
            document.getElementById(current_map_id+'_obj_'+new_position).style.fill = "green";
        }
        //if(!in_direction[new_position].includes(clicked_district[current_map_id])){
        //    in_direction[new_position][(theta_i+2)%4] = clicked_district[current_map_id];
        //}
        clicked_district[current_map_id] = new_position;
    }
    initialize_zooms();
};
function select_district(){
    initialize_view_box_dicts();
    var cardinal_directions = ["east","north","west","south"];
    var count_dict = {};
    var count_dict_by_district_id = {};
    var viewbox_size = (view_box_bounds_by_id[current_map_id][2])/
                       (ultimate_bounds_by_id[current_map_id][2]);
    for(var theta_i=0;theta_i<cardinal_directions.length;theta_i++){
        if(document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id])){
            document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('x1', document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id]).getAttribute('cx'));
            document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('y1', document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id]).getAttribute('cy'));
            var state_north_of_here = get_in_direction(current_map_id,clicked_district[current_map_id],theta_i,simple=true,simulate=true);
            if(state_north_of_here<0){
                state_north_of_here = clicked_district[current_map_id];
            }
            var target_x1 = parseFloat(document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id]).getAttribute('cx'));
            var target_y1 = parseFloat(document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id]).getAttribute('cy'));
            var target_x2 = parseFloat(document.getElementById(current_map_id+"_circle_"+state_north_of_here).getAttribute('cx'));
            var target_y2 = parseFloat(document.getElementById(current_map_id+"_circle_"+state_north_of_here).getAttribute('cy'));

            var full_line_length = Math.sqrt((target_x2-target_x1)**2 + (target_y2-target_y1)**2);
            var display_x2 = target_x2;
            var display_y2 = target_y2;
            if(full_line_length>0){
                display_x2 = target_x1+(target_x2-target_x1)*Math.max(full_line_length/2,full_line_length-(ARROWHEAD_PIXEL_GAP*viewbox_size))/full_line_length;
                display_y2 = target_y1+(target_y2-target_y1)*Math.max(full_line_length/2,full_line_length-(ARROWHEAD_PIXEL_GAP*viewbox_size))/full_line_length;
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").style.display = "block";
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('target_x2', target_x2);
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('target_y2', target_y2);
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('x2', display_x2.toString());
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('y2', display_y2.toString());
            }else{
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").style.display = "none";
            }

            if(state_north_of_here in count_dict){
                count_dict[state_north_of_here] = count_dict[state_north_of_here]+1;
            }else{
                count_dict[state_north_of_here] = 1;
            }


        }
        //MINILINES
        //there's one for each district and cardinal direction pair
        var district_circles = document.getElementsByClassName(current_map_id+"_district_circle");
        for(var district_i=0;district_i<district_circles.length;district_i++){
            var district_id = district_circles[district_i].getAttribute("district_id");

            var state_north_of_here = get_in_direction(current_map_id,district_id,theta_i,simple=true,simulate=true);
            if(state_north_of_here<0){
                state_north_of_here = district_id;
            }
            var target_x1 = parseFloat(document.getElementById(current_map_id+"_circle_"+district_id).getAttribute('cx'));
            var target_y1 = parseFloat(document.getElementById(current_map_id+"_circle_"+district_id).getAttribute('cy'));
            var target_x2 = parseFloat(document.getElementById(current_map_id+"_circle_"+state_north_of_here).getAttribute('cx'));
            var target_y2 = parseFloat(document.getElementById(current_map_id+"_circle_"+state_north_of_here).getAttribute('cy'));

            var full_line_length = Math.sqrt((target_x2-target_x1)**2 + (target_y2-target_y1)**2);

            var display_x_offset = (target_y2-target_y1)/full_line_length;
            var display_y_offset = -(target_x2-target_x1)/full_line_length;
            var display_x1 = target_x1+display_x_offset*ARROWHEAD_PIXEL_GAP/3*viewbox_size;
            var display_y1 = target_y1+display_y_offset*ARROWHEAD_PIXEL_GAP/3*viewbox_size;


            document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline")
                .setAttribute('x1', 
                display_x1);
            document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline")
                .setAttribute('y1', 
                display_y1);

            var display_x2 = target_x2;
            var display_y2 = target_y2;
            if(false&&full_line_length>0){
                display_x2 = target_x1+(target_x2-target_x1)*Math.max(full_line_length/2,full_line_length-(ARROWHEAD_PIXEL_GAP*2*viewbox_size))/full_line_length+display_x_offset*ARROWHEAD_PIXEL_GAP/3*viewbox_size;
                display_y2 = target_y1+(target_y2-target_y1)*Math.max(full_line_length/2,full_line_length-(ARROWHEAD_PIXEL_GAP*2*viewbox_size))/full_line_length+display_y_offset*ARROWHEAD_PIXEL_GAP/3*viewbox_size;
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").style.display = "block";
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('target_x2', target_x2);
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('target_y2', target_y2);
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('x2', display_x2.toString());
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('y2', display_y2.toString());
            }else{
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").style.display = "none";
            }

            if(!(district_id in count_dict_by_district_id)){
                count_dict_by_district_id[district_id] = {};
            }
            if(state_north_of_here in count_dict_by_district_id[district_id]){
                count_dict_by_district_id[district_id][state_north_of_here] = count_dict_by_district_id[district_id][state_north_of_here]+1;
            }else{
                count_dict_by_district_id[district_id][state_north_of_here] = 1;
            }


        }
    }

    var count_dict_2_by_district_id = {};
    var district_circles = document.getElementsByClassName(current_map_id+"_district_circle");
    for(var district_i=0;district_i<district_circles.length;district_i++){
        var district_id = district_circles[district_i].getAttribute("district_id");
        count_dict_2_by_district_id[district_id] = {};
        for(var theta_i=0;theta_i<cardinal_directions.length;theta_i++){
            var state_north_of_here = get_in_direction(current_map_id,district_id,theta_i,simple=true,simulate=true);
            if(state_north_of_here<0){
                state_north_of_here = district_id;
            }
            if(state_north_of_here in count_dict_2_by_district_id[district_id]){
                count_dict_2_by_district_id[district_id][state_north_of_here] = count_dict_2_by_district_id[district_id][state_north_of_here]+1;
            }else{
                count_dict_2_by_district_id[district_id][state_north_of_here] = 1;
            }
            if(count_dict_by_district_id[district_id][state_north_of_here]==1){
                document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"");
            }
            if(count_dict_by_district_id[district_id][state_north_of_here]==2){
                if(count_dict_2_by_district_id[district_id][state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"4");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"4");
                }else{
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 4 0");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"4");
                }
            }
            if(count_dict_by_district_id[district_id][state_north_of_here]==3){
                if(count_dict_2_by_district_id[district_id][state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"3 6");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"6");
                }else if(count_dict_2_by_district_id[district_id][state_north_of_here]==2){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 3 3 3");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"3");
                }else{
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 6 3 0");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"6");
                }
            }
            if(count_dict_by_district_id[district_id][state_north_of_here]==4){
                if(count_dict_2_by_district_id[district_id][state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"2.5 7.5");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"7.5");
                }else if(count_dict_2_by_district_id[district_id][state_north_of_here]==2){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 2.5 2.5 5");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"5");
                }else if(count_dict_2_by_district_id[district_id][state_north_of_here]==3){
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 5 2.5 2.5");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"5");
                }else{
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray',"0 7.5 2.5 0");
                    document.getElementById(current_map_id+"_"+district_id+"_"+cardinal_directions[theta_i]+"_miniarrowline").setAttribute('stroke-dasharray-max',"7.5");
                }
            }
        }
    }

    var count_dict_2 = {};
    for(var theta_i=0;theta_i<cardinal_directions.length;theta_i++){
        if(document.getElementById(current_map_id+"_circle_"+clicked_district[current_map_id])){
            var state_north_of_here = get_in_direction(current_map_id,clicked_district[current_map_id],theta_i,simple=true,simulate=true);
            if(state_north_of_here<0){
                state_north_of_here = clicked_district[current_map_id];
            }
            if(state_north_of_here in count_dict_2){
                count_dict_2[state_north_of_here] = count_dict_2[state_north_of_here]+1;
            }else{
                count_dict_2[state_north_of_here] = 1;
            }
            if(count_dict[state_north_of_here]==1){
                document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"");
            }
            if(count_dict[state_north_of_here]==2){
                if(count_dict_2[state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"4");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"4");
                }else{
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 4 0");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"4");
                }
            }
            if(count_dict[state_north_of_here]==3){
                if(count_dict_2[state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"3 6");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"6");
                }else if(count_dict_2[state_north_of_here]==2){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 3 3 3");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"3");
                }else{
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 6 3 0");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"6");
                }
            }
            if(count_dict[state_north_of_here]==4){
                if(count_dict_2[state_north_of_here]==1){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"2.5 7.5");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"7.5");
                }else if(count_dict_2[state_north_of_here]==2){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 2.5 2.5 5");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"5");
                }else if(count_dict_2[state_north_of_here]==3){
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 5 2.5 2.5");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"5");
                }else{
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray',"0 7.5 2.5 0");
                    document.getElementById(current_map_id+"_"+cardinal_directions[theta_i]+"_arrowline").setAttribute('stroke-dasharray-max',"7.5");
                }
            }
        }
    }
}
addEventListener("mousedown", (event) => {
    scores_storage = [];
    prev = [];
    already_passed = [];
    score_stacking = 1;
    var rect = document.getElementById(current_map_id).getBoundingClientRect();
    var mouse_x = event.clientX - rect.left;
    var mouse_y = event.clientY - rect.top;
    if(STANDARD_FILL){
        if(hovered_district[current_map_id]!=clicked_district[current_map_id]&&clicked_district[current_map_id]!=""){
            document.getElementById(current_map_id+'_obj_'+clicked_district[current_map_id]).style.fill = "grey";
        }
    }
    clicked_district[current_map_id] = hovered_district[current_map_id];
    document.getElementById(current_map_id+"_mouseover_rect").setAttribute('x', ""+mouse_x);
    document.getElementById(current_map_id+"_mouseover_rect").setAttribute('y', ""+mouse_y);
    document.getElementById(current_map_id+"_mouseover_text").setAttribute('x', ""+(mouseover_buffer+mouse_x));
    document.getElementById(current_map_id+"_mouseover_text").setAttribute('y', ""+(mouseover_buffer+mouse_y));
    initialize_zooms();
    color_map(current_map_id,clicked_district[current_map_id]);
    //document.getElementById("lean_mouseover_text").setAttribute('y', ""+(20+mouse_y))
});

initialize_zooms();
var map_svg_list = document.getElementsByClassName("MapSVG");
for(var i=0;i<map_svg_list.length;i++){
    var map_id = map_svg_list[i].id;
    var district_circles = document.getElementsByClassName(map_id+"_district_circle");
    for(var district_i=0;district_i<district_circles.length;district_i++){
        var district_id = district_circles[district_i].getAttribute("district_id").toString();
        var district_obj = document.getElementById(map_id+'_obj_'+district_id);
        var district_circle = district_circles[district_i];
        if(false){
            district_obj.style.fill = "red";
        }else{
            district_obj.style.fill = "grey";
        }
        district_circle.style.fill = district_obj.style.fill;
    }
}
</script>